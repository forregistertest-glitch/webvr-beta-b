<!DOCTYPE html>
<html lang="th" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMR Assessment Module (KAHIS)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="kahis-theme.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=vital_signs,person_edit" />
    
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>

    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

    <style>
        /* Utility */
        [x-cloak] { display: none !important; }

        /* History Table Thumbnails */
        .history-thumbnail { width: 50px; height: 50px; object-fit: cover; border-radius: 0.25rem; cursor: pointer; transition: transform 0.2s; }
        .history-thumbnail:hover { transform: scale(1.1); }
        
        /* ==========================================================================
           GLOBAL TABLE STYLES (มาตรฐานเดียวสำหรับทุกตาราง)
           ========================================================================== */
        
        /* 1. ขนาดและระยะห่าง (เหมือน Vital Signs) */
        #eyeHistoryTable th, #eyeHistoryTable td,
        #historyTable th, #historyTable td,
        #assessment-history-table th, #assessment-history-table td,
        #ext-doc-table th, #ext-doc-table td,
        #lisHistoryTable th, #lisHistoryTable td {
             padding: 12px 16px; 
             white-space: nowrap; 
             vertical-align: middle;
             border-bottom: 1px solid var(--color-border-base);
             color: var(--color-text-base);
        }

        /* 2. Sticky Headers (หัวตารางลอยติดบน) */
        #eyeHistoryTable thead th, 
        #historyTable thead th,
        #assessment-history-table thead th,
        #ext-doc-table thead th,
        #lisHistoryTable thead th { 
            position: sticky; 
            top: 0; 
            z-index: 10; 
            background-color: var(--color-bg-secondary); 
            font-weight: 600; /* ความหนาตัวอักษรมาตรฐาน */
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        .history-sort-header { cursor: pointer; transition: background-color 0.2s; }
        .history-sort-header:hover { background-color: var(--color-border-base); }

        /* 3. Sticky First Column (คอลัมน์แรกติดซ้าย) */
        #eyeHistoryTable th:first-child, #eyeHistoryTable td:first-child,
        #historyTable th:first-child, #historyTable td:first-child,
        #lisHistoryTable th:first-child, #lisHistoryTable td:first-child,
        #ext-doc-table th:first-child, #ext-doc-table td:first-child { 
            position: sticky; 
            left: 0; 
            background-color: var(--color-bg-content); 
            z-index: 20; 
            border-right: 1px solid var(--color-border-base);
        }
        /* (มุมซ้ายบนสุด - ต้องอยู่บนสุด) */
        #eyeHistoryTable thead th:first-child, 
        #historyTable thead th:first-child,
        #lisHistoryTable thead th:first-child,
        #ext-doc-table thead th:first-child {
            z-index: 30; 
            background-color: var(--color-bg-secondary);
        }

        /* 4. Hover Effect (แก้สีเพี้ยนคอลัมน์แรก) */
        tbody tr { transition: background-color 0.15s; }
        tbody tr:hover { background-color: var(--color-bg-secondary) !important; }
        tbody tr:hover > td:first-child { background-color: var(--color-bg-secondary) !important; }

        /* 5. Eye Exam Specific (หัวตาราง 2 บรรทัด) */
        .eye-header-multiline {
            white-space: normal !important; /* ให้ตัดคำได้ */
            text-align: left !important;    /* ชิดซ้ายเหมือน VS */
            vertical-align: bottom !important; /* ชิดล่างให้ตรงกับบรรทัด Date */
            min-width: 80px;
            line-height: 1.2;
            padding-bottom: 8px !important; /* เว้นระยะล่างนิดหน่อย */
        }
        .eye-header-sub {
            display: block;        /* ขึ้นบรรทัดใหม่ */
            font-size: 0.75em;     /* ตัวเล็กกว่า */
            font-weight: normal;   /* ตัวบาง */
            color: var(--color-text-muted);
            margin-top: 2px;
        }

        /* LIS Modal Styles */
        .modal-container { max-width: 1100px; margin: 0; background: white; border-radius: 8px; box-shadow: 0 0 20px rgba(0,0,0,0.2); display: flex; flex-direction: column; max-height: 90vh; width: 100%; }
        .dark .modal-container { background-color: var(--color-bg-content); }
        .list-frame { border: 1px solid var(--color-border-base); border-radius: 4px; display: flex; flex-direction: column; overflow: hidden; height: 100%; background-color: var(--color-bg-content); }
        .list-header { font-weight: 700; background-color: var(--color-bg-secondary); padding: 0.75rem 1rem; border-bottom: 1px solid var(--color-border-base); flex-shrink: 0; color: var(--color-text-base); z-index: 10; }
        .list-body { overflow-y: auto; flex: 1; }
        .test-list-item { padding: 0.5rem 1rem; cursor: pointer; border-bottom: 1px solid #f3f4f6; transition: background-color 0.15s; }
        .dark .test-list-item { border-bottom-color: var(--color-bg-secondary); }
        .test-list-item:hover { background-color: #e5e7eb; }
        .dark .test-list-item:hover { background-color: var(--color-bg-secondary); }
        .checkbox-label { display: flex; align-items: center; justify-content: space-between; padding: 0.5rem 1rem; color: var(--color-text-base); }
        .checkbox-label:hover { background-color: #f3f4f6; }
        .dark .checkbox-label:hover { background-color: var(--color-bg-secondary); }
        
        /* Form Styles */
        .form-input, .form-select { width: 100%; padding: 0.5rem; border-radius: 0.375rem; border: 1px solid var(--color-border-base); background-color: var(--color-bg-content); color: var(--color-text-base); }
        .form-label { display: block; font-size: 0.875rem; font-weight: 500; color: var(--color-text-muted); margin-bottom: 0.25rem; }
        .form-checkbox { height: 1rem; width: 1rem; border-radius: 0.25rem; border: 1px solid var(--color-border-base); }
        .form-input-datetime { position: relative; color: var(--color-text-base); }
        .form-input-datetime::-webkit-calendar-picker-indicator { opacity: 0.5; cursor: pointer; }
        .dark .form-input-datetime::-webkit-calendar-picker-indicator { filter: invert(0.6); }
    </style>
    
</head>
<body class="text-sm">

    <header class="bg-white dark:bg-[--color-bg-content] shadow-md p-2 flex justify-between items-center sticky top-0 z-50 dark:border-b dark:border-[--color-border-base]">
        <div class="flex items-center space-x-4">
            <div class="text-2xl font-bold text-green-700 px-2 flex-shrink-0" style="color: #006633;">KAHIS</div>
            <nav class="flex items-center space-x-1 text-xs font-medium">
                 <a href="#" class="px-3 py-2 text-gray-700 dark:text-[--color-text-base] font-semibold hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary] rounded">START search HN</a>

                <div class="relative group" x-data="{ open: false }">
                    <button @click="open = !open" @keydown.escape.window="open = false" class="flex items-center px-3 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary] rounded">
                        Registration <i data-lucide="chevron-down" class="w-3 h-3 ml-1"></i>
                    </button>
                    <div x-show="open" x-cloak @click.away="open = false"
                         x-transition:enter="transition ease-out duration-100"
                         x-transition:enter-start="transform opacity-0 scale-95"
                         x-transition:enter-end="transform opacity-100 scale-100"
                         x-transition:leave="transition ease-in duration-75"
                         x-transition:leave-start="transform opacity-100 scale-100"
                         x-transition:leave-end="transform opacity-0 scale-95"
                         class="absolute left-0 mt-1 w-48 bg-white dark:bg-[--color-bg-content] rounded-md shadow-lg border dark:border-[--color-border-base] z-50 py-1">
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">Search HN</a>
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">Register List</a>
                        <hr class="my-1 border-gray-200 dark:border-[--color-border-base]">
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">New Pet</a>
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">New Owner</a>
                        <hr class="my-1 border-gray-200 dark:border-[--color-border-base]">
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">CC editor</a>
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">Ref.Hos editor</a>
                        <hr class="my-1 border-gray-200 dark:border-[--color-border-base]">
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">Dashboard</a>
                    </div>
                </div>

                 <div class="relative group" x-data="{ open: false }">
                    <button @click="open = !open" @keydown.escape.window="open = false" class="flex items-center px-3 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary] rounded">
                        Appointment <i data-lucide="chevron-down" class="w-3 h-3 ml-1"></i>
                    </button>
                    <div x-show="open" x-cloak @click.away="open = false" x-transition class="absolute left-0 mt-1 w-48 bg-white dark:bg-[--color-bg-content] rounded-md shadow-lg border dark:border-[--color-border-base] z-50 py-1">
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">Main</a>
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">DVM Schedule</a>
                    </div>
                </div>

                <div class="relative group" x-data="{ open: false }">
                    <button @click="open = !open" @keydown.escape.window="open = false" class="flex items-center px-3 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary] rounded">
                        Cashier <i data-lucide="chevron-down" class="w-3 h-3 ml-1"></i>
                    </button>
                    <div x-show="open" x-cloak @click.away="open = false" x-transition class="absolute left-0 mt-1 w-48 bg-white dark:bg-[--color-bg-content] rounded-md shadow-lg border dark:border-[--color-border-base] z-50 py-1">
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">Bill by List</a>
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">Bill by HN</a>
                        <hr class="my-1 border-gray-200 dark:border-[--color-border-base]">
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">Deposit list</a>
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">Withdraw list</a>
                         <hr class="my-1 border-gray-200 dark:border-[--color-border-base]">
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">Coupon list</a>
                         <hr class="my-1 border-gray-200 dark:border-[--color-border-base]">
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">Debt list</a>
                         <hr class="my-1 border-gray-200 dark:border-[--color-border-base]">
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">Receipt list</a>
                         <hr class="my-1 border-gray-200 dark:border-[--color-border-base]">
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-1m0 dark:hover:bg-[--color-bg-secondary]">Clear Lock</a>
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">Financial Report</a>
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">Financial Report 01 log</a>
                    </div>
                </div>

                <a href="#" class="px-3 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary] rounded">List of order</a>

                <div class="relative group" x-data="{ open: false }">
                    <button @click="open = !open" @keydown.escape.window="open = false" class="flex items-center px-3 py-2 text-blue-600 dark:text-[--color-primary-500] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary] rounded">
                        VR (52039575) <i data-lucide="chevron-down" class="w-3 h-3 ml-1"></i>
                    </button>
                    <div x-show="open" x-cloak @click.away="open = false" x-transition class="absolute left-0 mt-1 w-48 bg-white dark:bg-[--color-bg-content] rounded-md shadow-lg border dark:border-[--color-border-base] z-50 py-1">
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">EMR</a>
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">History diagnosis</a>
                        <a href="#" class="block px-4 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary]">History financial items</a>
                    </div>
                </div>
                <a href="#" class="px-3 py-2 text-blue-600 dark:text-[--color-primary-500] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary] rounded">My Coupon</a>
                <a href="#" class="px-3 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary] rounded">Setting</a>
                <a href="#" class="px-3 py-2 text-gray-700 dark:text-[--color-text-base] hover:bg-gray-100 dark:hover:bg-[--color-bg-secondary] rounded">Admin</a>

            </nav>
            </div>

        <div class="flex items-center space-x-3 flex-shrink-0 self-center">
             <img src="https://placehold.co/32x32/cccccc/333333?text=User" alt="User Avatar" class="w-8 h-8 rounded object-cover flex-shrink-0">
             <div class="text-right text-xs dark:text-[--color-text-base]">
                <div class="-ml-1">นิพนธ์ วงศ์ประเสริฐ</div>
                <div class="text-gray-500 dark:text-[--color-text-muted]">23 hrs 44 mins</div>
            </div>
            <button class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap h-8 flex items-center justify-center">
                <i data-lucide="log-out" class="inline-block w-4 h-4 mr-1"></i> Log out
            </button>
        </div>
    </header>

    <div class="bg-gray-100 dark:bg-[--color-bg-secondary] p-2 shadow-sm flex justify-start items-center space-x-4">
        <img src="https://placehold.co/32x32/a0aec0/4a5568?text=Pet" alt="Pet Avatar" class="w-8 h-8 rounded object-cover flex-shrink-0">
        <div class="flex items-center space-x-4">
             <div class="grid grid-cols-4 gap-x-4 gap-y-1 text-xs font-semibold dark:text-[--color-text-base]">
                <div>OPD No.: <span class="text-blue-600 dark:text-[--color-primary-500]">52039575</span></div>
                <div>ชื่อสัตว์เลี้ยง: <span class="text-blue-600 dark:text-[--color-primary-500]">คุณส้มจี๊ด(จี๊ดจ๊าด)</span></div>
                <div>Species / Breed: <span class="text-blue-600 dark:text-[--color-primary-500]">CAT (ABYSSINIAN)</span></div>
                <div>เจ้าของ: <span class="text-blue-600 dark:text-[--color-primary-500]">คุณพ่อส้มจี๊ด</span></div>
                <div>Owner No.: <span class="text-blue-600 dark:text-[--color-primary-500]">W12345678</span></div>
                 <div>Gender: <span class="text-blue-600 dark:text-[--color-primary-500]">FS</span></div>
                 <div>Age: <span class="text-blue-600 dark:text-[--color-primary-500]">14Y 10M 19D</span></div>
                <div>Blood Group: <span class="text-blue-600 dark:text-[--color-primary-500]">DEA 1.1 Negative</span></div>
            </div>
        </div>
        <img src="https://placehold.co/32x32/cccccc/333333?text=Owner" alt="Owner Avatar" class="w-8 h-8 rounded object-cover flex-shrink-0">
        <div class="flex space-x-3 text-xs dark:text-[--color-text-base]">
            <label class="flex items-center"><input type="checkbox" class="mr-1"> VET</label>
            <label class="flex items-center"><input type="checkbox" class="mr-1" checked> KU</label>
            <label class="flex items-center"><input type="checkbox" class="mr-1"> VIP</label>
            <label class="flex items-center"><input type="checkbox" class="mr-1" checked> อื่นๆ</label>
        </div>
    </div>

    <nav class="bg-white dark:bg-[--color-bg-content] shadow-sm -mt-px dark:border-b dark:border-[--color-border-base]">
        <div class="max-w-full mx-auto">
            <div class="flex space-x-1 overflow-x-auto">
                <a href="#" class="tab-inactive emr-tab dark:text-[--color-text-muted] px-3 py-2 text-sm" data-target="quick_view_content.html">Quick view</a>
                <a href="#" class="tab-inactive emr-tab dark:text-[--color-text-muted] px-3 py-2 text-sm" data-target="subj_content.html">Subj</a>
                <a href="#" class="tab-inactive emr-tab dark:text-[--color-text-muted] px-3 py-2 text-sm" data-target="obj_content.html">Obj</a>
                <a href="#" class="tab-active emr-tab dark:text-[--color-primary-500] dark:border-[--color-primary-500] px-3 py-2 text-sm" data-target="assessment_content.html">Assessment</a>
                <a href="#" class="tab-inactive emr-tab dark:text-[--color-text-muted] px-3 py-2 text-sm" data-target="plan_content.html">Plan</a>
                <a href="#" class="tab-inactive emr-tab dark:text-[--color-text-muted] px-3 py-2 text-sm" data-target="sys_exam_content.html">Sys Exam</a>
                <a href="#" class="tab-inactive emr-tab dark:text-[--color-text-muted] px-3 py-2 text-sm" data-target="order_pe_content.html">Order PE</a>
                <a href="#" class="tab-inactive emr-tab dark:text-[--color-text-muted] px-3 py-2 text-sm" data-target="order_tx_content.html">Order TX</a>
                <a href="#" class="tab-inactive emr-tab dark:text-[--color-text-muted] px-3 py-2 text-sm" data-target="order_lis_content.html">Order LIS</a>
                
                <a href="#" class="tab-inactive emr-tab dark:text-[--color-text-muted] px-3 py-2 text-sm" data-target="order_path_content.html">Order Path</a>
                
                <a href="#" class="tab-inactive emr-tab dark:text-[--color-text-muted] px-3 py-2 text-sm" data-target="order_rx_content.html">Order RX</a>
                <a href="#" class="tab-inactive emr-tab dark:text-[--color-text-muted] px-3 py-2 text-sm" data-target="lab_viewer_content.html">Lab Viewer</a>
                <a href="#" class="tab-inactive emr-tab dark:text-[--color-text-muted] px-3 py-2 text-sm" data-target="pets_note_content.html">Pet's Note</a>
                <a href="#" class="tab-inactive emr-tab dark:text-[--color-text-muted] px-3 py-2 text-sm" data-target="ext_doc_content.html">Ext Doc</a>
            </div>
        </div>
    </nav>

    <main id="emr-content-placeholder"></main>

    <div class="bg-gray-800 dark:bg-[--color-text-base] text-gray-300 dark:text-[--color-text-muted] p-4 text-xs">
        <div class="container mx-auto grid grid-cols-3 items-center">
            
            <div class="grid grid-cols-3 gap-x-6">
                <a href="#" class="hover:underline">Hyperlink text to announcement 1</a>
                <a href="#" class="hover:underline">Hyperlink text to announcement 2</a>
                <a href="#" class="hover:underline">Hyperlink text to announcement 3</a>
                <a href="#" class="hover:underline">Hyperlink text to announcement 1</a>
                <a href="#" class="hover:underline">Hyperlink text to announcement 2</a>
                <a href="#" class="hover:underline">Hyperlink text to announcement 3</a>
            </div>

            <div class="text-center">
                <div>ระบบเวชระเบียนอิเล็กทรอนิกส์ โรงพยาบาลสัตว์มหาวิทยาลัยเกษตรศาสตร์</div>
                <div>Version X.X.X.X, 31 Dec 2025</div>
            </div>

            <div></div>

        </div>
    </div>

    <div id="df-popup-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[100] hidden">
        <div class="bg-white dark:bg-[--color-bg-content] rounded-lg shadow-xl max-w-md w-full p-6 relative">
            <button id="df-popup-close-x" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:text-[--color-text-muted]">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-[--color-text-base]">การลงข้อมูลค่า DF</h2>
            <div class="border border-gray-300 dark:border-[--color-border-base] rounded-lg p-4 mb-5 space-y-2 text-sm dark:text-[--color-text-base]">
                <div><strong>HN :</strong> <span class="text-blue-600 dark:text-[--color-primary-500] font-medium">52039575</span></div>
                <div><strong>Pet Name :</strong> <span class="text-blue-600 dark:text-[--color-primary-500] font-medium">คุณส้มจี๊ด(จี๊ดจ๊าด)</span></div>
                <div><strong>Owner Name :</strong> <span class="text-blue-600 dark:text-[--color-primary-500] font-medium">คุณพ่อส้มจี๊ด</span></div>
                <div><strong>Date Record :</strong> <span class="font-medium">31 Dec 2025 , 23:59</span></div>
                <div class="flex items-center space-x-2 pt-1">
                    <strong class="flex-shrink-0 w-20">DVM</strong>
                    <select class="flex-1 w-full border border-gray-300 dark:border-[--color-border-base] rounded-lg p-2 text-sm dark:bg-[--color-bg-secondary] text-gray-500 dark:text-[--color-text-muted]">
                        <option selected disabled>Default User (DVM) login</option>
                        <option value="user1" class="text-black dark:text-[--color-text-base]">นพพร ยงยุทธ (User A)</option>
                        <option value="user2" class="text-black dark:text-[--color-text-base]">คุณหมอ B (User B)</option>
                    </select>
                </div>
                 <div class="flex items-center space-x-2 pt-1">
                    <strong class="flex-shrink-0 w-20">Department</strong>
                    <select class="flex-1 w-full border border-gray-300 dark:border-[--color-border-base] rounded-lg p-2 text-sm dark:bg-[--color-bg-secondary] text-gray-500 dark:text-[--color-text-muted]">
                        <option selected disabled>Default Department login</option>
                        <option value="dep101" class="text-black dark:text-[--color-text-base]">101 อายุรกรรมทั่วไปนอกเวลา</option>
                        <option value="dep102" class="text-black dark:text-[--color-text-base]">102 คลินิกพิเศษนอกเวลา</option>
                        <option value="dep103" class="text-black dark:text-[--color-text-base]">103 รังสีวินิจฉัยนอกเวลา</option>
                    </select>
                </div>
                 <div class="flex items-center space-x-2 pt-1">
                    <strong class="flex-shrink-0 w-20">Date Visit</strong>
                    <select class="flex-1 w-full border border-gray-300 dark:border-[--color-border-base] rounded-lg p-2 text-sm dark:bg-[--color-bg-secondary] text-gray-500 dark:text-[--color-text-muted]">
                        <option selected disabled>31 Dec 2025 (Last)</option>
                        <option value="2025-12-30" class="text-black dark:text-[--color-text-base]">30 Dec 2025</option>
                        <option value="2025-12-29" class="text-black dark:text-[--color-text-base]">29 Dec 2025</option>
                        <option value="2025-09-05" class="text-black dark:text-[--color-text-base]">5 Sep 2025</option>
                        <option value="2024-08-27" class="text-black dark:text-[--color-text-base]">27 Aug 2024</option>
                    </select>
                </div>
                <p class="text-xs text-gray-600 dark:text-[--color-text-muted] pt-2">
                    ก่อนลงข้อมูลโปรดตรวจสอบข้อมูลเดิมตามวันด้านบนทุกครั้ง<br>เพื่อป้องกันการลงข้อมูลซ้ำ
                </p>
                <p class="text-xs text-red-600 font-medium">
                    กรณีลงข้อมูลซ้ำโปรดแจ้งการเงินเพื่อแก้ไขทันที
                </p>
                 <p class="text-xs text-red-600 font-medium pt-1">
                    สามารถเข้าดูข้อมูลการบันทึกค่าใช้จ่ายในระบบของ HN นี้ได้ที่ส่วน Quick view ใน EMR module ส่วน Financial
                </p>
            </div>
            <div class="space-y-3">
                <label for="df-type" class="block font-semibold text-gray-700 dark:text-[--color-text-base]">เลือกชนิด DF</label>
                <select id="df-type" class="w-full border border-gray-300 dark:border-[--color-border-base] rounded-lg p-2 text-sm dark:bg-[--color-bg-secondary] text-gray-500 dark:text-[--color-text-muted]">
                    <option selected disabled>DF : Select DF Type</option>
                    <option value="type1" class="text-black dark:text-[--color-text-base]">Type 1</option>
                    <option value="type2" class="text-black dark:text-[--color-text-base]">Type 2</option>
                    <option value="type3" class="text-black dark:text-[--color-text-base]">Type 3</option>
                </select>
            </div>
            <div class="flex justify-end space-x-3 mt-6">
                <button id="df-popup-cancel" class="bg-gray-200 hover:bg-gray-300 text-gray-800 dark:bg-[--color-bg-secondary] dark:hover:bg-[--color-border-base] dark:text-[--color-text-base] px-4 py-2 rounded-lg text-sm font-medium">
                    ยกเลิก
                </button>
                <button class="bg-orange-500 hover:bg-orange-600 dark:bg-[--color-orange-500] dark:hover:bg-[--color-orange-600] text-white px-4 py-2 rounded-lg text-sm font-medium">
                    บันทึกการลงข้อมูล DF
                </button>
            </div>
        </div>
    </div>

    <div id="tf-popup-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[100] hidden">
        <div class="bg-white dark:bg-[--color-bg-content] rounded-lg shadow-xl max-w-md w-full p-6 relative">
            <button id="tf-popup-close-x" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:text-[--color-text-muted]">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-[--color-text-base]">การลงข้อมูลค่า TF (Tech Fee)</h2>
            <div class="border border-gray-300 dark:border-[--color-border-base] rounded-lg p-4 mb-5 space-y-2 text-sm dark:text-[--color-text-base]">
                <div><strong>HN :</strong> <span class="text-blue-600 dark:text-[--color-primary-500] font-medium">52039575</span></div>
                <div><strong>Pet Name :</strong> <span class="text-blue-600 dark:text-[--color-primary-500] font-medium">คุณส้มจี๊ด(จี๊ดจ๊าด)</span></div>
                <div><strong>Owner Name :</strong> <span class="text-blue-600 dark:text-[--color-primary-500] font-medium">คุณพ่อส้มจี๊ด</span></div>
                <div><strong>Date Record :</strong> <span class="font-medium">31 Dec 2025 , 23:59</span></div>
                <div class="flex items-center space-x-2 pt-1">
                    <strong class="flex-shrink-0 w-20">Tech</strong>
                    <select class="flex-1 w-full border border-gray-300 dark:border-[--color-border-base] rounded-lg p-2 text-sm dark:bg-[--color-bg-secondary] text-gray-500 dark:text-[--color-text-muted]">
                        <option selected disabled>Default User (Tech) login</option>
                        <option value="user1" class="text-black dark:text-[--color-text-base]">นพพร ยงยุทธ (User A)</option>
                        <option value="user2" class="text-black dark:text-[--color-text-base]">คุณ B (User B)</option>
                    </select>
                </div>
                 <div class="flex items-center space-x-2 pt-1">
                    <strong class="flex-shrink-0 w-20">Department</strong>
                    <select class="flex-1 w-full border border-gray-300 dark:border-[--color-border-base] rounded-lg p-2 text-sm dark:bg-[--color-bg-secondary] text-gray-500 dark:text-[--color-text-muted]">
                        <option selected disabled>Default Department login</option>
                        <option value="dep101" class="text-black dark:text-[--color-text-base]">101 อายุรกรรมทั่วไปนอกเวลา</option>
                        <option value="dep102" class="text-black dark:text-[--color-text-base]">102 คลินิกพิเศษนอกเวลา</option>
                        <option value="dep103" class="text-black dark:text-[--color-text-base]">103 รังสีวินิจฉัยนอกเวลา</option>
                    </select>
                </div>
                 <div class="flex items-center space-x-2 pt-1">
                    <strong class="flex-shrink-0 w-20">Date Visit</strong>
                    <select class="flex-1 w-full border border-gray-300 dark:border-[--color-border-base] rounded-lg p-2 text-sm dark:bg-[--color-bg-secondary] text-gray-500 dark:text-[--color-text-muted]">
                        <option selected disabled>31 Dec 2025 (Last)</option>
                        <option value="2025-12-30" class="text-black dark:text-[--color-text-base]">30 Dec 2025</option>
                        <option value="2025-12-29" class="text-black dark:text-[--color-text-base]">29 Dec 2025</option>
                        <option value="2025-09-05" class="text-black dark:text-[--color-text-base]">5 Sep 2025</option>
                        <option value="2024-08-27" class="text-black dark:text-[--color-text-base]">27 Aug 2024</option>
                    </select>
                </div>
                <p class="text-xs text-gray-600 dark:text-[--color-text-muted] pt-2">
                    ก่อนลงข้อมูลโปรดตรวจสอบข้อมูลเดิมตามวันด้านบนทุกครั้ง<br>เพื่อป้องกันการลงข้อมูลซ้ำ
                </p>
                <p class="text-xs text-red-600 font-medium">
                    กรณีลงข้อมูลซ้ำโปรดแจ้งการเงินเพื่อแก้ไขทันที
                </p>
                 <p class="text-xs text-red-600 font-medium pt-1">
                    สามารถเข้าดูข้อมูลการบันทึกค่าใช้จ่ายในระบบของ HN นี้ได้ที่ส่วน Quick view ใน EMR module ส่วน Financial
                </p>
            </div>
            <div class="space-y-3">
                <label for="tf-type" class="block font-semibold text-gray-700 dark:text-[--color-text-base]">เลือกชนิด TF</label>
                <select id="tf-type" class="w-full border border-gray-300 dark:border-[--color-border-base] rounded-lg p-2 text-sm dark:bg-[--color-bg-secondary] text-gray-500 dark:text-[--color-text-muted]">
                    <option selected disabled>TF : Select TF Type</option>
                    <option value="type1" class="text-black dark:text-[--color-text-base]">Type 1</option>
                    <option value="type2" class="text-black dark:text-[--color-text-base]">Type 2</option>
                    <option value="type3" class="text-black dark:text-[--color-text-base]">Type 3</option>
                </select>
            </div>
            <div class="flex justify-end space-x-3 mt-6">
                <button id="tf-popup-cancel" class="bg-gray-200 hover:bg-gray-300 text-gray-800 dark:bg-[--color-bg-secondary] dark:hover:bg-[--color-border-base] dark:text-[--color-text-base] px-4 py-2 rounded-lg text-sm font-medium">
                    ยกเลิก
                </button>
                <button class="bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                    บันทึกการลงข้อมูล TF
                </button>
            </div>
        </div>
    </div>

    <div id="problem-list-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[100] hidden">
        <div class="bg-white dark:bg-[--color-bg-content] rounded-lg shadow-xl max-w-5xl w-full p-0 relative" style="max-height: 90vh; display: flex; flex-direction: column;">
            
            <button id="problem-list-popup-close-x" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:text-[--color-text-muted]">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            
            <div class="p-4 border-b border-gray-200 dark:border-[--color-border-base] flex-shrink-0">
                <h2 class="text-xl font-semibold text-gray-800 dark:text-[--color-text-base]">Problem List Editor</h2>
            </div>
            
            <div class="p-4 overflow-y-auto">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="md:col-span-1 border border-gray-300 dark:border-[--color-border-base] rounded-lg overflow-hidden">
                       <div class="flex border-b border-gray-200 dark:border-[--color-border-base]">
                           <button class="flex-1 text-center py-2 px-4 text-sm font-semibold text-blue-600 dark:text-[--color-primary-500] border-b-2 border-blue-600 dark:border-[--color-primary-500]">
                               Category
                           </button>
                           <button class="flex-1 text-center py-2 px-4 text-sm font-medium text-gray-500 hover:text-gray-700 dark:text-[--color-text-muted] dark:hover:text-[--color-text-base]">
                               Search
                           </button>
                       </div>
                       <ul id="category-list" class="divide-y divide-gray-200 dark:divide-[--color-border-base] overflow-y-auto dark:text-[--color-text-base] h-80" style="height: 20rem;">
                           <li data-category-id="common" class="p-3 cursor-pointer bg-gray-100 dark:bg-[rgba(139,125,107,0.15)] font-semibold">1. Common Problem</li>
                           <li data-category-id="eye" class="p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-[--color-bg-secondary]/50">2. Eye</li>
                           <li data-category-id="ear" class="p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-[--color-bg-secondary]/50">3. Ear</li>
                           <li data-category-id="nose" class="p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-[--color-bg-secondary]/50">4. Nose</li>
                           <li data-category-id="throat" class="p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-[--color-bg-secondary]/50">5. Throat</li>
                           <li data-category-id="abdomen" class="p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-[--color-bg-secondary]/50">6. Abdomen</li>
                           <li data-category-id="trauma" class="p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-[--color-bg-secondary]/50">7. Trauma</li>
                           <li data-category-id="bone" class="p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-[--color-bg-secondary]/50">8. Bone</li>
                           <li data-category-id="behavier" class="p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-[--color-bg-secondary]/50">9. Behavier</li>
                       </ul>
                   </div>
                   <div class="md:col-span-2 border border-gray-300 dark:border-[--color-border-base] rounded-lg overflow-hidden flex flex-col">
                       <div class="p-2 border-b border-gray-200 dark:border-[--color-border-base] flex-shrink-0">
                           <h3 id="result-header" class="font-semibold dark:text-[--color-text-base]">Result (0 selected)</h3>
                       </div>
                       <div class="overflow-y-auto" style="height: 20rem;">
                           <table class="w-full text-left text-sm table-fixed">
                               <thead class="border-b border-gray-200 dark:border-[--color-border-base] sticky top-0">
                                   <tr>
                                       <th class="p-3 w-[10%] dark:bg-[--color-bg-secondary] dark:text-[--color-text-base]"><input type="checkbox"></th>
                                       <th class="p-3 font-semibold w-[60%] dark:bg-[--color-bg-secondary] dark:text-[--color-text-base]">Term</th>
                                       <th class="p-3 font-semibold w-[30%] dark:bg-[--color-bg-secondary] dark:text-[--color-text-base]">TAG</th>
                                   </tr>
                               </thead>
                               <tbody id="result-table-body" class="divide-y divide-gray-200 dark:divide-[--color-border-base] dark:text-[--color-text-base]">
                                   </tbody>
                           </table>
                       </div>
                   </div>
                </div>
            </div>
            
            <div class="flex justify-between items-center p-4 border-t border-gray-200 dark:border-[--color-border-base] mt-2 flex-shrink-0">
                <button id="problem-list-popup-cancel" class="bg-gray-200 hover:bg-gray-300 text-gray-800 dark:bg-[--color-bg-secondary] dark:hover:bg-[--color-border-base] dark:text-[--color-text-base] px-4 py-2 rounded-lg text-sm font-medium">
                    Close
                </button>
                <button class="bg-green-600 hover:bg-green-700 dark:bg-[--color-green-600] dark:hover:bg-[--color-green-700] text-white px-4 py-2 rounded-lg text-sm font-medium">
                    Confirm Problem List Selection
                </button>
            </div>
            
        </div>
    </div>
    
    <div id="vitals-popup-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 md:p-8 z-[100] hidden">
        <div class="max-w-7xl w-full mx-auto bg-[var(--color-bg-content)] rounded-lg shadow-lg overflow-hidden border border-[var(--color-border-base)] flex flex-col" style="max-height: 90vh;">

            <header class="relative flex justify-between items-center p-6 border-b border-[var(--color-border-base)] flex-shrink-0">
                <div>
                    <h1 class="text-2xl font-bold text-[var(--color-text-base)]">การประเมิน Vital Signs</h1>
                </div>
                <button id="close-vitals-popup-x" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:text-[--color-text-muted]">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </header>

            <div class="flex flex-col lg:flex-row flex-1 overflow-hidden">

                <aside class="w-full lg:w-72 flex-shrink-0 border-b lg:border-b-0 lg:border-r border-[var(--color-border-base)] bg-[var(--color-bg-secondary)] overflow-y-auto">
                    <nav class="flex lg:flex-col" aria-label="Tabs">
                        <button class="vitals-tab-link tab-active w-1/2 lg:w-full text-left px-6 py-4 text-sm font-medium" data-tab="vitals-history">
                            <div class="flex items-center space-x-3">
                                <i data-lucide="history" class="w-5 h-5"></i>
                                <span>History</span>
                            </div>
                            <span class="text-xs block text-[var(--color-text-muted)] mt-1 ml-8">ประวัติ Vital signs</span>
                        </button>
                        <button class="vitals-tab-link tab-inactive w-1/2 lg:w-full text-left px-6 py-4 text-sm font-medium" data-tab="new-vitals">
                            <div class="flex items-center space-x-3">
                                <i data-lucide="clipboard-list" class="w-5 h-5"></i>
                                <span>New Vital Signs</span>
                            </div>
                            <span class="text-xs block text-[var(--color-text-muted)] mt-1 ml-8">บันทึกข้อมูล Vital signs ใหม่</span>
                        </button>
                    </nav>
                </aside>

                <main class="w-full flex-1 overflow-y-auto">
                    <div id="content-vitals-history" class="vitals-tab-content h-full flex flex-col p-6 md:p-8">
                        <div class="flex justify-between items-center mb-5 flex-shrink-0">
                            <h2 class="text-xl font-semibold flex items-center text-[var(--color-text-base)]">
                                <i data-lucide="history" class="w-6 h-6 mr-3 text-[var(--color-primary-500)]"></i>
                                ประวัติ Vital Signs
                            </h2>
                            <div class="flex space-x-2">
                                <button id="bp-chart-btn" class="flex items-center space-x-1.5 px-4 py-2 rounded-md bg-[var(--color-primary-600)] text-white hover:bg-[var(--color-primary-700)] dark:bg-[var(--color-primary-600)] dark:hover:bg-[var(--color-primary-700)] transition-colors text-sm font-medium">
                                    <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
                                    <span>BP Chart</span>
                                </button>
                                <button id="vitals-chart-btn" class="flex items-center space-x-1.5 px-4 py-2 rounded-md bg-[var(--color-primary-600)] text-white hover:bg-[var(--color-primary-700)] dark:bg-[var(--color-primary-600)] dark:hover:bg-[var(--color-primary-700)] transition-colors text-sm font-medium">
                                    <i data-lucide="line-chart" class="w-4 h-4"></i>
                                    <span>Vital Signs Chart</span>
                                </button>
                            </div>
                        </div>
                        <div class="rounded-lg border border-[var(--color-border-base)] shadow-sm overflow-auto flex-1">
                            <table id="historyTable" class="min-w-full text-sm"> 
                                <thead class="bg-[var(--color-bg-secondary)]">
                                    <tr>
                                        <th scope="col" class="history-sort-header text-left text-[var(--color-text-base)]" data-sort="datetime">
                                            <div class="flex items-center">
                                                Date/Time (Eff.)
                                                <span class="sort-icon desc">
                                                    <i data-lucide="arrow-down" class="w-4 h-4"></i>
                                                </span>
                                            </div>
                                        </th>
                                        <th scope="col" class="history-sort-header text-left text-[var(--color-text-base)]" data-sort="temp">Temp (°F)</th>
                                        <th scope="col" class="history-sort-header text-left text-[var(--color-text-base)]" data-sort="rr">RR</th>
                                        <th scope="col" class="history-sort-header text-left text-[var(--color-text-base)]" data-sort="hr">HR</th>
                                        <th scope="col" class="history-sort-header text-left text-[var(--color-text-base)]" data-sort="bp">BP</th>
                                        <th scope="col" class="history-sort-header text-left text-[var(--color-text-base)]" data-sort="pulse">Pulse</th>
                                        <th scope="col" class="history-sort-header text-left text-[var(--color-text-base)]" data-sort="crt">CRT</th>
                                        <th scope="col" class="history-sort-header text-left text-[var(--color-text-base)]" data-sort="fbs">FBS</th>
                                        <th scope="col" class="history-sort-header text-left text-[var(--color-text-base)]" data-sort="mm">MM</th>
                                        <th scope="col" class="history-sort-header text-left text-[var(--color-text-base)]" data-sort="lung">Lung</th>
                                        <th scope="col" class="history-sort-header text-left text-[var(--color-text-base)]" data-sort="heart">Heart</th>
                                        <th scope="col" class="history-sort-header text-left text-[var(--color-text-base)]" data-sort="pulse_quality">Pulse Q.</th>
                                        <th scope="col" class="history-sort-header text-left text-[var(--color-text-base)]" data-sort="loc">L.O.C</th>
                                        <th scope="col" class="history-sort-header text-left text-[var(--color-text-base)]" data-sort="pain">Pain</th>
                                        <th scope="col" class="history-sort-header text-left text-[var(--color-text-base)]" data-sort="cyanosis">Cyanosis</th>
                                        <th scope="col" class="history-sort-header text-left text-[var(--color-text-base)]" data-sort="seizure">Seizure</th>
                                        <th scope="col" class="history-sort-header text-left text-[var(--color-text-base)]" data-sort="arrest">Arrest</th>
                                        <th scope="col" class="history-sort-header text-left text-[var(--color-text-base)]" data-sort="note">Note</th>
                                        
                                        <th scope="col" class="text-left text-[var(--color-text-base)]">DVM</th>
                                        <th scope="col" class="text-left text-[var(--color-text-base)]">Dept</th>
                                        <th scope="col" class="text-left text-[var(--color-text-base)]">User Record</th>
                                        <th scope="col" class="text-left text-[var(--color-text-base)]">Create Time</th>
                                        <th scope="col" class="text-left text-[var(--color-text-base)]">Update Time</th>
                                        
                                        <th scope="col" class="text-left font-semibold text-[var(--color-text-base)]">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="historyTableBody" class="divide-y divide-[var(--color-border-base)] bg-[var(--color-bg-content)]">
                                    </tbody>
                            </table>
                        </div>
                        <div id="noHistoryMessage" class="hidden text-center p-8 text-[var(--color-text-muted)]">
                            <i data-lucide="folder-clock" class="w-12 h-12 mx-auto mb-4"></i>
                            <p>No vital sign history found.</p>
                        </div>
                    </div>
                    
                    <div id="content-new-vitals" class="vitals-tab-content hidden space-y-4 p-6 md:p-8">
                        
                     <section class="p-6 rounded-lg border border-[var(--color-border-base)] bg-[var(--color-bg-content)] shadow-sm">
                            <div class="flex justify-between items-center mb-5">
                                <h2 class="text-xl font-semibold flex items-center text-[var(--color-text-base)]">
                                    <i data-lucide="heart-pulse" class="w-6 h-6 mr-3 text-[var(--color-primary-500)]"></i>
                                    Vital Signs (สัญญาณชีพ)
                                </h2>
                                <button class="flex items-center space-x-1 text-xs font-medium text-[var(--color-text-muted)] hover:text-[var(--color-danger)] transition-colors">
                                    <i data-lucide="x" class="w-3 h-3"></i>
                                    <span>Clear</span>
                                </button>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                <div>
                                    <label for="vs-temp" class="form-label">Temp (°F)</label>
                                    <input type="text" id="vs-temp" class="form-input" placeholder="e.g. 98.6">
                                </div>
                                <div>
                                    <label for="vs-rr" class="form-label">RR (rpm)</label>
                                    <input type="text" id="vs-rr" class="form-input" placeholder="e.g. 18">
                                </div>
                                <div>
                                    <label for="vs-hr" class="form-label">HR (bpm)</label>
                                    <input type="text" id="vs-hr" class="form-input" placeholder="e.g. 88">
                                </div>
                                <div>
                                    <label for="vs-bp" class="form-label">BP (mmHg)</label>
                                    <input type="text" id="vs-bp" class="form-input" placeholder="e.g. 120/80">
                                </div>
                                <div>
                                    <label for="vs-pulse" class="form-label">Pulse (bpm)</label>
                                    <input type="text" id="vs-pulse" class="form-input" placeholder="e.g. 72">
                                </div>
                                <div>
                                    <label for="vs-crt" class="form-label">CRT (sec)</label>
                                    <input type="text" id="vs-crt" class="form-input" placeholder="e.g. <2">
                                </div>
                                <div>
                                    <label for="vs-fbs" class="form-label">FBS (mg/dL)</label>
                                    <input type="text" id="vs-fbs" class="form-input" placeholder="e.g. 100">
                                </div>
                            </div>
                        </section>
                        
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                            <section class="p-6 rounded-lg border border-[var(--color-border-base)] bg-[var(--color-bg-content)] shadow-sm md:col-span-2">
                                <h2 class="text-xl font-semibold mb-5 flex items-center text-[var(--color-text-base)]">
                                    <i data-lucide="alert-triangle" class="w-6 h-6 mr-3 text-[var(--color-primary-500)]"></i>
                                    Critical Events
                                </h2>
                                <div class="flex flex-col space-y-4">
                                    <div class="flex items-center">
                                        <input id="check-cyanosis" type="checkbox" class="form-checkbox">
                                        <label for="check-cyanosis" class="ml-3 block text-sm text-[var(--color-text-base)]">Cyanosis</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input id="check-seizure" type="checkbox" class="form-checkbox">
                                        <label for="check-seizure" class="ml-3 block text-sm text-[var(--color-text-base)]">Seizure</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input id="check-arrest" type="checkbox" class="form-checkbox">
                                        <label for="check-arrest" class="ml-3 block text-sm text-[var(--color-text-base)]">Arrest</label>
                                    </div>
                                </div>
                            </section>
                            
                            <section class="p-6 rounded-lg border border-[var(--color-border-base)] bg-[var(--color-bg-content)] shadow-sm md:col-span-3">
                                <div class="flex justify-between items-center mb-5">
                                    <h2 class="text-xl font-semibold flex items-center text-[var(--color-text-base)]">
                                        <i data-lucide="user-check" class="w-6 h-6 mr-3 text-[var(--color-primary-500)]"></i>
                                        General (การประเมินทั่วไป)
                                    </h2>
                                    <button class="flex items-center space-x-1 text-xs font-medium text-[var(--color-text-muted)] hover:text-[var(--color-danger)] transition-colors">
                                        <i data-lucide="x" class="w-3 h-3"></i>
                                        <span>Clear</span>
                                    </button>
                                </div>
                                <div class="space-y-6">
                                    <div class="w-3/5">
                                        <label for="mucous-dropdown" class="form-label">Mucous Membrane</label>
                                        <select id="mucous-dropdown" class="form-input form-select">
                                            <option value="" selected disabled class="form-select-placeholder">Select</option>
                                            <option value="Normal">Normal (Pink and Moist)</option>
                                            <option value="Pale">Pale or White</option>
                                            <option valuea="Yellow">Yellow</option>
                                            <option value="Blue">Blue or Muddy</option>
                                            <option value="Dry">Dry or tacky</option>
                                        </select>
                                    </div>
                                    <div class="w-3/5">
                                        <label for="lung-dropdown" class="form-label">Lung Sound</label>
                                        <select id="lung-dropdown" class="form-input form-select">
                                            <option value="" selected disabled class="form-select-placeholder">Select</option>
                                            <option value="Normal">Normal</option>
                                            <option value="Wheeze">Wheeze</option>
                                            <option value="Crackles">Crackles</option>
                                            <option value="Rhonchi">Rhonchi</option>
                                        </select>
                                    </div>
                                    <div class="w-3/5">
                                        <label for="heart-dropdown" class="form-label">Heart Sound</label>
                                        <select id="heart-dropdown" class="form-input form-select">
                                            <option value="" selected disabled class="form-select-placeholder">Select</option>
                                            <option value="Normal">Normal</option>
                                            <option value="Murmur">Murmur</option>
                                        </select>
                                    </div>
                                    <div class="w-3/5">
                                        <label for="pulse-quality-dropdown" class="form-label">Pulse</label>
                                        <select id="pulse-quality-dropdown" class="form-input form-select">
                                            <option value="" selected disabled class="form-select-placeholder">Select</option>
                                            <option value="Strong">Strong</option>
                                            <option value="Weak">Weak</option>
                                            <option value="Bounding">Bounding</option>
                                            <option value="Thready">Thready</option>
                                            <option value="Absent">Absent</option>
                                        </select>
                                    </div>
                                    <div class="w-3/5">
                                        <label for="gcs-dropdown" class="form-label">Level of Consciousness</label>
                                        <select id="gcs-dropdown" class="form-input form-select">
                                            <option value="" selected disabled class="form-select-placeholder">Select</option>
                                            <option value="E4V5M6">E4V5M6 - Alert and Oriented</option>
                                            <option value="E3V4M5">E3V4M5 - Confused</option>
                                            <option value="E2V3M4">E2V3M4 - Drowsy</option>
                                            <option value="E1V1M1">E1V1M1 - Unresponsive</option>
                                        </select>
                                    </div>
                                    <div class="w-3/5">
                                        <label for="pain-score-dropdown" class="form-label">Pain Score (0-10)</label>
                                        <select id="pain-score-dropdown" class="form-input form-select">
                                            <option value="" selected disabled class="form-select-placeholder">Select</option>
                                            <option value="0">0</option>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                            <option value="8">8</option>
                                            <option value="9">9</option>
                                            <option value="10">10</option>
                                        </select>
                                    </div>
                                </div>
                            </section>
                        </div>

                        <section class="p-6 rounded-lg border border-[var(--color-border-base)] bg-[var(--color-bg-content)] shadow-sm">
                            <h2 class="text-xl font-semibold mb-5 flex items-center text-[var(--color-text-base)]">
                                <i data-lucide="activity" class="w-6 h-6 mr-3 text-[var(--color-primary-500)]"></i>
                                Note (บันทึก)
                            </h2>
                            <div>
                                <textarea id="system-review-notes" rows="4" class="form-input" placeholder="พิมพ์ข้อความสั้นๆ"></textarea>
                            </div>
                        </section>
                        <section class="p-6 rounded-lg border border-[var(--color-border-base)] bg-[var(--color-bg-content)] shadow-sm">
                            <h2 class="text-xl font-semibold mb-5 flex items-center text-[var(--color-text-base)]">
                                <i data-lucide="calendar-clock" class="w-6 h-6 mr-3 text-[var(--color-primary-500)]"></i>
                                Effective Date/Time
                            </h2>
                            <p class="text-xs text-[var(--color-text-muted)] mb-3 -mt-3">
                                (เวลาของข้อมูลที่ต้องการให้แสดงผล)
                            </p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="vs-effective-date" class="form-label">Date</label>
                                    <input type="date" id="vs-effective-date" class="form-input form-input-datetime" placeholder="Current date" required>
                                </div>
                                <div>
                                    <label for="vs-effective-time" class="form-label">Time</label>
                                    <input type="time" id="vs-effective-time" class="form-input form-input-datetime" placeholder="Current time" required>
                                </div>
                            </div>
                        </section>
                        <section class="p-6 rounded-lg border border-[var(--color-border-base)] bg-[var(--color-bg-content)] shadow-sm">
                            <h2 class="text-xl font-semibold mb-5 flex items-center text-[var(--color-text-base)]">
                                <i data-lucide="users" class="w-6 h-6 mr-3 text-[var(--color-primary-500)]"></i>
                                Record Meta (ข้อมูลการบันทึก)
                            </h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="vs-dvm" class="form-label">DVM (Optional)</label>
                                    <select id="vs-dvm" class="form-input form-select">
                                        <option value="" selected>(None)</option>
                                        <option value="Dr. AAA">Dr. AAA</option>
                                        <option value="Dr. BBB">Dr. BBB</option>
                                        <option value="Dr. CCC">Dr. CCC</option>
                                        <option value="Dr. Eye">Dr. Eye</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="vs-department" class="form-label">Department (Default from Login)</label>
                                    <select id="vs-department" class="form-input form-select">
                                        <option value="101 อายุรกรรม" selected>101 อายุรกรรม (Default)</option>
                                        <option value="201 ฉุกเฉิน">201 ฉุกเฉิน</option>
                                        <option value="301 คลินิกพิเศษ">301 คลินิกพิเศษ</option>
                                    </select>
                                </div>
                            </div>
                        </section>
                        
                        </div>
                </main>
            </div>    

            <footer class="flex-shrink-0 flex justify-between items-center p-4 border-t border-[var(--color-border-base)] bg-[var(--color-bg-secondary)]">
                <button id="close-vitals-popup-cancel" class="px-4 py-2 rounded-md bg-gray-200 hover:bg-gray-300 dark:bg-[var(--color-border-base)] dark:hover:bg-[var(--color-border-base)] text-gray-700 dark:text-[var(--color-text-base)] text-sm font-medium">
                    Close
                </button>
                <button id="btn-save-vitals" class="flex items-center space-x-1.5 px-6 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 dark:bg-[--color-primary-600] dark:hover:bg-[--color-primary-700] transition-colors text-sm font-medium">
    <i data-lucide="save" class="w-4 h-4"></i>
    <span>Save Vital Signs</span>
</button>
            </footer>
        </div>
    </div>
    
    <div id="eye-exam-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 md:p-8 z-[100] hidden">
        <div class="max-w-7xl w-full mx-auto bg-[var(--color-bg-content)] rounded-lg shadow-lg overflow-hidden border border-[var(--color-border-base)] flex flex-col" style="max-height: 90vh;">

            <header class="relative flex justify-between items-center p-6 border-b border-[var(--color-border-base)] flex-shrink-0">
                <div>
                    <h1 class="text-2xl font-bold text-[var(--color-text-base)]">การประเมินการตรวจตา (Ophthalmology Exam)</h1>
                </div>
                <button id="close-eye-popup-x" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:text-[--color-text-muted]">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </header>

            <div class="flex flex-col lg:flex-row flex-1 overflow-hidden">
                <aside class="w-full lg:w-72 flex-shrink-0 border-b lg:border-b-0 lg:border-r border-[var(--color-border-base)] bg-[var(--color-bg-secondary)] overflow-y-auto">
                    <nav class="flex lg:flex-col" aria-label="Tabs">
                        <button class="eye-tab-link tab-active w-1/2 lg:w-full text-left px-6 py-4 text-sm font-medium" data-tab="eye-history">
                            <div class="flex items-center space-x-3">
                                <i data-lucide="history" class="w-5 h-5"></i>
                                <span>History</span>
                            </div>
                            <span class="text-xs block text-[var(--color-text-muted)] mt-1 ml-8">ประวัติการตรวจตา</span>
                        </button>
                        <button class="eye-tab-link tab-inactive w-1/2 lg:w-full text-left px-6 py-4 text-sm font-medium" data-tab="new-eye-exam">
                            <div class="flex items-center space-x-3">
                                <i data-lucide="clipboard-list" class="w-5 h-5"></i>
                                <span>New Eye Exam</span>
                            </div>
                            <span class="text-xs block text-[var(--color-text-muted)] mt-1 ml-8">บันทึกข้อมูลการตรวจตา</span>
                        </button>
                    </nav>
                </aside>

                <main class="w-full flex-1 overflow-y-auto">
                    <div id="content-eye-history" class="eye-tab-content h-full flex flex-col p-6 md:p-8">
                        <h2 class="text-xl font-semibold flex items-center text-[var(--color-text-base)] mb-5">
                            <i data-lucide="history" class="w-6 h-6 mr-3 text-indigo-600"></i>
                            ประวัติการตรวจตา
                        </h2>
                        <div class="rounded-lg border border-[var(--color-border-base)] shadow-sm overflow-auto flex-1">
                            <table id="eyeHistoryTable" class="min-w-full text-sm">
                                <thead class="bg-[var(--color-bg-secondary)]">
                                    <tr>
                                        <th scope="col" class="history-sort-header text-left text-[var(--color-text-base)]" data-sort="datetime" style="min-width: 160px;">
                                            <div class="flex items-center">
                                                Date/Time (Eff.) 
                                                <span class="sort-icon desc"><i data-lucide="arrow-down" class="w-4 h-4 ml-1"></i></span>
                                            </div>
                                        </th>
                                        
                                        <th scope="col" class="eye-header-multiline text-[var(--color-text-base)]">PLR<span class="eye-header-sub">(OD)</span></th>
                                        <th scope="col" class="eye-header-multiline text-[var(--color-text-base)]">PLR<span class="eye-header-sub">(OS)</span></th>
                                        
                                        <th scope="col" class="eye-header-multiline text-[var(--color-text-base)]">Palp<span class="eye-header-sub">(OD)</span></th>
                                        <th scope="col" class="eye-header-multiline text-[var(--color-text-base)]">Palp<span class="eye-header-sub">(OS)</span></th>
                                        
                                        <th scope="col" class="eye-header-multiline text-[var(--color-text-base)]">Dazzle<span class="eye-header-sub">(OD)</span></th>
                                        <th scope="col" class="eye-header-multiline text-[var(--color-text-base)]">Dazzle<span class="eye-header-sub">(OS)</span></th>
                                        
                                        <th scope="col" class="eye-header-multiline text-[var(--color-text-base)]">Menace<span class="eye-header-sub">(OD)</span></th>
                                        <th scope="col" class="eye-header-multiline text-[var(--color-text-base)]">Menace<span class="eye-header-sub">(OS)</span></th>
                                        
                                        <th scope="col" class="eye-header-multiline text-[var(--color-text-base)]">STT<span class="eye-header-sub">(OD)</span></th>
                                        <th scope="col" class="eye-header-multiline text-[var(--color-text-base)]">STT<span class="eye-header-sub">(OS)</span></th>
                                        
                                        <th scope="col" class="eye-header-multiline text-[var(--color-text-base)]">Fluoro<span class="eye-header-sub">(OD)</span></th>
                                        <th scope="col" class="eye-header-multiline text-[var(--color-text-base)]">Fluoro<span class="eye-header-sub">(OS)</span></th>
                                        
                                        <th scope="col" class="eye-header-multiline text-[var(--color-text-base)]">IOP<span class="eye-header-sub">(OD)</span></th>
                                        <th scope="col" class="eye-header-multiline text-[var(--color-text-base)]">IOP<span class="eye-header-sub">(OS)</span></th>
                                        
                                        <th scope="col" class="text-center font-semibold text-[var(--color-text-base)]" style="min-width: 80px; vertical-align: middle;">Image</th>
                                        
                                        <th scope="col" class="text-left text-[var(--color-text-base)]">DVM</th>
                                        <th scope="col" class="text-left text-[var(--color-text-base)]">Dept</th>
                                        <th scope="col" class="text-left text-[var(--color-text-base)]">User</th>
                                        <th scope="col" class="text-left text-[var(--color-text-base)]">Create</th>
                                        <th scope="col" class="text-left text-[var(--color-text-base)]">Update</th>
                                        <th scope="col" class="text-left font-semibold text-[var(--color-text-base)]">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="eyeHistoryTableBody" class="divide-y divide-[var(--color-border-base)] bg-[var(--color-bg-content)]">
                                    </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div id="content-new-eye-exam" class="eye-tab-content hidden space-y-6 p-6 md:p-8">
                        <section class="p-6 rounded-lg border border-[var(--color-border-base)] bg-[var(--color-bg-content)] shadow-sm">
                            <h2 class="text-xl font-semibold mb-5 flex items-center text-[var(--color-text-base)]">
                                <i data-lucide="file-text" class="w-6 h-6 mr-3 text-indigo-600"></i>
                                Eye Exam Results
                            </h2>
                            <div class="grid grid-cols-3 gap-x-6 gap-y-4 items-center">
                                <div></div>
                                <div class="font-semibold text-center dark:text-[--color-text-base]">OD (Right Eye)</div>
                                <div class="font-semibold text-center dark:text-[--color-text-base]">OS (Left Eye)</div>
                                
                                <label class="form-label justify-self-end">Pupillary light reflex (PLR)</label>
                                <select class="form-input form-select">
                                    <option value="" selected disabled class="form-select-placeholder">+ / - / Sluggish</option>
                                    <option value="+">+</option>
                                    <option value="-">-</option>
                                    <option value="Sluggish">Sluggish</option>
                                </select>
                                <select class="form-input form-select">
                                    <option value="" selected disabled class="form-select-placeholder">+ / - / Sluggish</option>
                                    <option value="+">+</option>
                                    <option value="-">-</option>
                                    <option value="Sluggish">Sluggish</option>
                                </select>

                                <label class="form-label justify-self-end">Palpebral Reflex</label>
                                <select class="form-input form-select">
                                    <option value="" selected disabled class="form-select-placeholder">+ / -</option>
                                    <option value="+">+</option>
                                    <option value="-">-</option>
                                </select>
                                <select class="form-input form-select">
                                    <option value="" selected disabled class="form-select-placeholder">+ / -</option>
                                    <option value="+">+</option>
                                    <option value="-">-</option>
                                </select>

                                <label class="form-label justify-self-end">Dazzle Reflex</label>
                                <select class="form-input form-select">
                                    <option value="" selected disabled class="form-select-placeholder">+ / -</option>
                                    <option value="+">+</option>
                                    <option value="-">-</option>
                                </select>
                                <select class="form-input form-select">
                                    <option value="" selected disabled class="form-select-placeholder">+ / -</option>
                                    <option value="+">+</option>
                                    <option value="-">-</option>
                                </select>

                                <label class="form-label justify-self-end">Menace Response</label>
                                <select class="form-input form-select">
                                    <option value="" selected disabled class="form-select-placeholder">+ / -</option>
                                    <option value="+">+</option>
                                    <option value="-">-</option>
                                </select>
                                <select class="form-input form-select">
                                    <option value="" selected disabled class="form-select-placeholder">+ / -</option>
                                    <option value="+">+</option>
                                    <option value="-">-</option>
                                </select>

                                <label class="form-label justify-self-end">Schirmer Tear Test (mm/min)</label>
                                <input type="text" id="eye_stt_od" data-numpad="true" class="form-input" placeholder="e.g. 15" readonly>
                                <input type="text" id="eye_stt_os" data-numpad="true" class="form-input" placeholder="e.g. 15" readonly>

                                <label class="form-label justify-self-end">Fluorescein Stain</label>
                                <select class="form-input form-select">
                                    <option value="" selected disabled class="form-select-placeholder">Positive / Negative</option>
                                    <option value="Positive">Positive</option>
                                    <option value="Negative">Negative</option>
                                </select>
                                <select class="form-input form-select">
                                    <option value="" selected disabled class="form-select-placeholder">Positive / Negative</option>
                                    <option value="Positive">Positive</option>
                                    <option value="Negative">Negative</option>
                                </select>

                                <label class="form-label justify-self-end">Intraocular Pressure (mmHg)</label>
                                <input type="text" id="eye_iop_od" data-numpad="true" class="form-input" placeholder="e.g. 18" readonly>
                                <input type="text" id="eye_iop_os" data-numpad="true" class="form-input" placeholder="e.g. 18" readonly>
                            </div>
                        </section>
                        
                        <section class="p-6 rounded-lg border border-[var(--color-border-base)] bg-[var(--color-bg-content)] shadow-sm">
                            <h2 class="text-xl font-semibold mb-5 flex items-center text-[var(--color-text-base)]">
                                <i data-lucide="image" class="w-6 h-6 mr-3 text-indigo-600"></i>
                                Eye Diagrams
                            </h2>
                            <p class="text-sm text-[var(--color-text-muted)] mb-4">Click button to open drawing tool for annotation.</p>
                            
                            <div class="text-center">
                                <button id="open-drawing-tool" class="bg-indigo-100 hover:bg-indigo-200 dark:bg-[--color-bg-secondary] dark:hover:bg-[--color-border-base] text-indigo-700 dark:text-indigo-400 font-semibold py-3 px-6 rounded-lg">
                                    Open Eye Diagram (Demo)
                                </button>
                            </div>
                        </section>
                    </div>
                </main>
            </div>

            <footer class="flex-shrink-0 flex justify-between items-center p-4 border-t border-[var(--color-border-base)] bg-[var(--color-bg-secondary)]">
                <button id="close-eye-popup-cancel" class="px-4 py-2 rounded-md bg-gray-200 hover:bg-gray-300 dark:bg-[var(--color-border-base)] dark:hover:bg-[var(--color-border-base)] text-gray-700 dark:text-[var(--color-text-base)] text-sm font-medium">
                    Close
                </button>
                <button class="flex items-center space-x-1.5 px-6 py-2 rounded-md bg-indigo-600 text-white hover:bg-indigo-700 transition-colors text-sm font-medium">
                    <i data-lucide="save" class="w-4 h-4"></i>
                    <span>Save Eye Exam</span>
                </button>
            </footer>
        </div>
    </div>
    
    <div id="drawing-demo-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-[110] hidden">
        <div class="bg-white dark:bg-[--color-bg-content] rounded-lg shadow-xl max-w-4xl w-full p-6 relative flex flex-col" style="max-height: 90vh;">
            <button id="close-drawing-demo-x" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:text-[--color-text-muted]">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-[--color-text-base]">Drawing Tool (Demo)</h2>
            
            <div class="flex-1 grid grid-cols-1 md:grid-cols-2 gap-4 overflow-y-auto">
                <div class="space-y-2">
                    <div class="flex space-x-2">
                        <button id="drawing-mode-btn" class="bg-blue-600 text-white px-3 py-1 rounded text-xs">Pen</button>
                        <button id="text-mode-btn" class="bg-gray-200 dark:bg-[--color-bg-secondary] dark:text-[--color-text-base] text-black px-3 py-1 rounded text-xs">Text</button>
                        <input type="color" id="drawing-color-picker" value="#E11D48" class="h-8">
                        <button id="drawing-undo-btn" class="bg-gray-200 dark:bg-[--color-bg-secondary] dark:text-[--color-text-base] text-black px-3 py-1 rounded text-xs flex items-center"><i data-lucide="undo-2" class="w-3 h-3 mr-1"></i>Undo</button>
                        <button id="drawing-clear-btn" class="bg-red-500 text-white px-3 py-1 rounded text-xs flex items-center"><i data-lucide="trash-2" class="w-3 h-3 mr-1"></i>Clear</button>
                    </div>
                    <div class="border border-gray-400">
                        <canvas id="drawing-canvas"></canvas>
                    </div>
                </div>
                <div class="space-y-2">
                    <h3 class="font-semibold dark:text-[--color-text-base]">Result (After "Fake Save"):</h3>
                    <img id="drawing-result-image" class="w-full border border-gray-300 rounded" alt="Drawing output will appear here">
                </div>
            </div>

            <div class="flex justify-end space-x-3 mt-6 flex-shrink-0">
                <button id="drawing-demo-cancel" class="bg-gray-200 hover:bg-gray-300 text-gray-800 dark:bg-[--color-bg-secondary] dark:hover:bg-[--color-border-base] dark:text-[--color-text-base] px-4 py-2 rounded-lg text-sm font-medium">
                    Cancel
                </button>
                <button id="drawing-demo-save" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                    <i data-lucide="save" class="inline-block w-4 h-4 mr-1.5"></i> Fake Save
                </button>
            </div>
        </div>
    </div>
    
    <div id="image-viewer-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 z-[120] hidden">
        <button id="close-image-viewer-x" class="absolute top-6 right-6 text-white hover:text-gray-300">
            <i data-lucide="x" class="w-10 h-10"></i>
        </button>
        <div class="max-w-4xl max-h-[90vh] w-full h-full">
            <img id="full-image-viewer-src" src="" alt="Enlarged exam image" class="w-full h-full object-contain">
        </div>
    </div>
    
    <div id="numpad-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[120] hidden">
        <div class="bg-white dark:bg-[--color-bg-content] rounded-lg shadow-xl w-full max-w-xs p-4">
            <h3 class="text-lg font-semibold mb-4 text-center dark:text-[--color-text-base]">Enter Value</h3>
            <input type="hidden" id="numpad-target-id">
            
            <div class="grid grid-cols-3 gap-2">
                <button data-value="7" class="numpad-btn text-xl font-bold p-4 rounded bg-gray-200 dark:bg-[--color-bg-secondary] dark:text-[--color-text-base] hover:bg-gray-300">7</button>
                <button data-value="8" class="numpad-btn text-xl font-bold p-4 rounded bg-gray-200 dark:bg-[--color-bg-secondary] dark:text-[--color-text-base] hover:bg-gray-300">8</button>
                <button data-value="9" class="numpad-btn text-xl font-bold p-4 rounded bg-gray-200 dark:bg-[--color-bg-secondary] dark:text-[--color-text-base] hover:bg-gray-300">9</button>
                
                <button data-value="4" class="numpad-btn text-xl font-bold p-4 rounded bg-gray-200 dark:bg-[--color-bg-secondary] dark:text-[--color-text-base] hover:bg-gray-300">4</button>
                <button data-value="5" class="numpad-btn text-xl font-bold p-4 rounded bg-gray-200 dark:bg-[--color-bg-secondary] dark:text-[--color-text-base] hover:bg-gray-300">5</button>
                <button data-value="6" class="numpad-btn text-xl font-bold p-4 rounded bg-gray-200 dark:bg-[--color-bg-secondary] dark:text-[--color-text-base] hover:bg-gray-300">6</button>
                
                <button data-value="1" class="numpad-btn text-xl font-bold p-4 rounded bg-gray-200 dark:bg-[--color-bg-secondary] dark:text-[--color-text-base] hover:bg-gray-300">1</button>
                <button data-value="2" class="numpad-btn text-xl font-bold p-4 rounded bg-gray-200 dark:bg-[--color-bg-secondary] dark:text-[--color-text-base] hover:bg-gray-300">2</button>
                <button data-value="3" class="numpad-btn text-xl font-bold p-4 rounded bg-gray-200 dark:bg-[--color-bg-secondary] dark:text-[--color-text-base] hover:bg-gray-300">3</button>
                
                <button data-value="." class="numpad-btn text-xl font-bold p-4 rounded bg-gray-200 dark:bg-[--color-bg-secondary] dark:text-[--color-text-base] hover:bg-gray-300">.</button>
                <button data-value="0" class="numpad-btn text-xl font-bold p-4 rounded bg-gray-200 dark:bg-[--color-bg-secondary] dark:text-[--color-text-base] hover:bg-gray-300">0</button>
                <button data-value="backspace" class="numpad-btn text-xl font-bold p-4 rounded bg-gray-200 dark:bg-[--color-bg-secondary] dark:text-[--color-text-base] hover:bg-gray-300 flex justify-center items-center">
                    <i data-lucide="delete" class="w-6 h-6"></i>
                </button>
            </div>
            <div class="grid grid-cols-2 gap-2 mt-2">
                <button data-value="clear" class="numpad-btn p-3 rounded bg-orange-500 text-white font-semibold">Clear</button>
                <button data-value="close" class="numpad-btn p-3 rounded bg-blue-600 text-white font-semibold">Close</button>
            </div>
        </div>
    </div>
    
    <div id="lightbox-album-modal" class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black bg-opacity-75 hidden">
        <button id="lightbox-album-close" class="lightbox-button absolute top-4 right-4 z-[120]">
            <i data-lucide="x" class="w-6 h-6"></i>
        </button>

        <button id="lightbox-album-prev" class="lightbox-button absolute left-4 sm:left-10 z-[120]">
            <i data-lucide="chevron-left" class="w-8 h-8"></i>
        </button>
        <button id="lightbox-album-next" class="lightbox-button absolute right-4 sm:right-10 z-[120]">
            <i data-lucide="chevron-right" class="w-8 h-8"></i>
        </button>

        <div class="relative w-auto h-auto max-w-[90vw] max-h-[90vh]">
            <img id="lightbox-album-image" src="https://placehold.co/800x600/000000/ffffff?text=Loading..." alt="ขยายภาพ" class="max-w-[90vw] max-h-[90vh] rounded-lg shadow-lg">
            <div id="lightbox-album-counter" class="absolute bottom-4 left-1/2 -translate-x-1/2 bg-black bg-opacity-60 text-white text-xs px-3 py-1 rounded-full">
                1 / 3
            </div>
        </div>
    </div>

    <div id="lis-popup-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 md:p-8 z-[100] hidden">
        <div class="max-w-7xl w-full mx-auto bg-[var(--color-bg-content)] rounded-lg shadow-lg overflow-hidden border border-[var(--color-border-base)] flex flex-col" style="max-height: 90vh;">

            <div id="lis-form-view" class="flex flex-col flex-1 h-full overflow-hidden">
                <header class="relative flex justify-between items-center p-6 border-b border-[var(--color-border-base)] flex-shrink-0">
                    <div><h1 class="text-2xl font-bold text-[var(--color-text-base)]">LIS Request</h1></div>
                    <button id="close-lis-popup-x" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:text-[--color-text-muted]"><i data-lucide="x" class="w-6 h-6"></i></button>
                </header>

                <div class="flex flex-col lg:flex-row flex-1 overflow-hidden">
                    
                    <aside class="w-full lg:w-72 flex-shrink-0 border-b lg:border-b-0 lg:border-r border-[var(--color-border-base)] bg-[var(--color-bg-secondary)] overflow-y-auto">
                        <nav class="flex lg:flex-col" aria-label="Tabs">
                            <button class="lis-tab-link tab-active w-1/2 lg:w-full text-left px-6 py-4 text-sm font-medium" data-tab="lis-history">
                                <div class="flex items-center space-x-3"><i data-lucide="history" class="w-5 h-5"></i><span>History</span></div>
                                <span class="text-xs block text-[var(--color-text-muted)] mt-1 ml-8">ประวัติ LIS (Pending/Completed)</span>
                            </button>
                            <button class="lis-tab-link tab-inactive w-1/2 lg:w-full text-left px-6 py-4 text-sm font-medium" data-tab="new-lis">
                                <div class="flex items-center space-x-3"><i data-lucide="clipboard-list" class="w-5 h-5"></i><span>New LIS Request</span></div>
                                <span class="text-xs block text-[var(--color-text-muted)] mt-1 ml-8">บันทึกข้อมูล LIS ใหม่</span>
                            </button>
                        </nav>
                    </aside>

                    <main class="w-full flex-1 overflow-y-auto max-h-[calc(90vh-140px)] p-6 md:p-8 relative">
                        
                        <div id="content-new-lis" class="lis-tab-content hidden space-y-8">
                            
                            <section>
                                <h2 class="text-xl font-semibold mb-4 text-gray-700 dark:text-[--color-text-base]">1. Select Tests</h2>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 h-[350px]">
                                    
                                    <div class="list-frame">
                                        <div class="list-header">LIS Category</div>
                                        <ul id="lis-category-list" class="list-body text-sm dark:text-[--color-text-base]">
                                            <li data-category="health_s" class="test-list-item font-semibold bg-gray-100 dark:bg-[rgba(139,125,107,0.15)]">ตรวจสุขภาพ S</li>
                                            <li data-category="health_m" class="test-list-item">ตรวจสุขภาพ M</li>
                                            <li data-category="health_l" class="test-list-item">ตรวจสุขภาพ L</li>
                                            <li data-category="detail_1" class="test-list-item">ตรวจละเอียดมาก 1</li>
                                            <li data-category="detail_2" class="test-list-item">ตรวจละเอียดมาก 2</li>
                                            <li data-category="detail_3" class="test-list-item">ตรวจละเอียดมาก 3</li>
                                            <li data-category="detail_4" class="test-list-item">ตรวจละเอียดมาก 4</li>
                                            <li data-category="detail_5" class="test-list-item">ตรวจละเอียดมาก 5</li>
                                            <li data-category="detail_6" class="test-list-item">ตรวจละเอียดมาก 6</li>
                                            <li data-category="detail_7" class="test-list-item">ตรวจละเอียดมาก 7</li>
                                            <li data-category="detail_8" class="test-list-item">ตรวจละเอียดมาก 8</li>
                                        </ul>
                                    </div>

                                    <div class="list-frame">
                                        <div class="list-header flex items-center">
                                            <input type="checkbox" id="check-all-tests" class="form-checkbox mr-2">
                                            <label for="check-all-tests" class="text-sm font-bold cursor-pointer">Cost Items</label>
                                        </div>
                                        <ul id="lis-cost-item-list" class="list-body text-sm">
                                            <li class="p-3 text-center text-gray-500">Select a category</li>
                                        </ul>
                                    </div>

                                    <div class="list-frame">
                                        <div class="list-header">LIS Items (Preview)</div>
                                        <div id="lis-preview-list" class="list-body p-3 text-sm space-y-1">
                                            <p id="lis-preview-placeholder" class="text-center text-gray-500 mt-4">(No items selected)</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-4 flex justify-end">
                                    <button id="btn-add-selected-tests" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm font-medium">
                                        <i data-lucide="plus" class="w-4 h-4 inline mr-1"></i> Add Selected Tests
                                    </button>
                                </div>
                            </section>

                            <section>
                                <h2 class="text-xl font-semibold mb-4 text-gray-700 dark:text-[--color-text-base]">2. Selected Tests (<span id="lis-selected-count">0</span> Items)</h2>
                                <div class="border dark:border-[--color-border-base] rounded-lg overflow-x-auto">
                                    <table class="w-full text-sm">
                                        <thead>
                                            <tr class="bg-gray-200 text-gray-700 dark:bg-[--color-bg-secondary] dark:text-[--color-text-base]">
                                                <th class="p-2 w-[5%]">#</th>
                                                <th class="p-2 w-[40%]">Term (ชื่อรายการแล็บ)</th>
                                                <th class="p-2 w-[15%]">Kind (หมวด)</th>
                                                <th class="p-2 w-[15%]">จำนวนสั่ง</th>
                                                <th class="p-2 w-[15%]">Unit</th>
                                                <th class="p-2 w-[10%]">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="lis-selected-table-body" class="dark:text-[--color-text-base] divide-y dark:divide-[--color-border-base]">
                                            <tr><td colspan="6" class="p-3 text-center text-gray-500">No tests added</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </section>

                            <section class="p-6 rounded-lg border border-[var(--color-border-base)] bg-[var(--color-bg-content)] shadow-sm">
                                <h2 class="text-xl font-semibold mb-5 flex items-center text-[var(--color-text-base)]"><i data-lucide="activity" class="w-6 h-6 mr-3 text-pink-600"></i> 3. Note (บันทึก)</h2>
                                <textarea id="lis-note" rows="2" class="form-input" placeholder="พิมพ์ข้อความสั้นๆ"></textarea>
                            </section>

                            <section class="p-6 rounded-lg border border-[var(--color-border-base)] bg-[var(--color-bg-content)] shadow-sm">
                                <h2 class="text-xl font-semibold mb-5 flex items-center text-[var(--color-text-base)]"><i data-lucide="calendar-clock" class="w-6 h-6 mr-3 text-pink-600"></i> 4. Effective Date/Time</h2>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div><label class="form-label">Date</label><input type="date" id="lis-effective-date" class="form-input"></div>
                                    <div><label class="form-label">Time</label><input type="time" id="lis-effective-time" class="form-input"></div>
                                </div>
                            </section>

                            <section class="p-6 rounded-lg border border-[var(--color-border-base)] bg-[var(--color-bg-content)] shadow-sm">
                                <h2 class="text-xl font-semibold mb-5 flex items-center text-[var(--color-text-base)]"><i data-lucide="users" class="w-6 h-6 mr-3 text-pink-600"></i> 5. Record Meta</h2>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div><label class="form-label">DVM</label><select id="lis-dvm" class="form-input"><option>Dr. AAA</option></select></div>
                                    <div><label class="form-label">Dept</label><select id="lis-department" class="form-input"><option>101 อายุรกรรม</option></select></div>
                                </div>
                            </section>
                        </div>

                        <div id="content-lis-history" class="lis-tab-content h-full flex flex-col">
                            <h2 class="text-xl font-semibold flex items-center text-[var(--color-text-base)] mb-5"><i data-lucide="history" class="w-6 h-6 mr-3 text-pink-600"></i> ประวัติ LIS Request</h2>
                            <div class="rounded-lg border border-[var(--color-border-base)] shadow-sm overflow-auto flex-1">
                                <table id="lisHistoryTable" class="min-w-full text-sm text-left">
                                    <thead class="bg-[var(--color-bg-secondary)] font-semibold text-[var(--color-text-base)]">
                                        <tr>
                                            <th class="p-3 whitespace-nowrap sticky left-0 z-20 bg-[var(--color-bg-secondary)]">Date/Time</th>
                                            <th class="p-3 whitespace-nowrap">Acc No.</th>
                                            <th class="p-3 whitespace-nowrap">Tests</th>
                                            <th class="p-3 whitespace-nowrap">Note</th>
                                            <th class="p-3 whitespace-nowrap">DVM</th>
                                            <th class="p-3 whitespace-nowrap">Dept</th>
                                            <th class="p-3 whitespace-nowrap">User</th>
                                            <th class="p-3 whitespace-nowrap">Create</th>
                                            <th class="p-3 whitespace-nowrap">Update</th>
                                            <th class="p-3 whitespace-nowrap text-center">Status</th>
                                            <th class="p-3 whitespace-nowrap">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lisHistoryTableBody" class="divide-y divide-[var(--color-border-base)]">
                                        </tbody>
                                </table>
                            </div>
                            <div id="noLisHistoryMessage" class="hidden text-center p-8 text-[var(--color-text-muted)]">
                                <i data-lucide="folder-clock" class="w-12 h-12 mx-auto mb-4"></i>
                                <p>No LIS history found.</p>
                            </div>
                        </div>
                    </main>
                </div>

                <footer class="flex-shrink-0 flex justify-between items-center p-4 border-t border-[var(--color-border-base)] bg-[var(--color-bg-secondary)]">
                    <button id="close-lis-popup-cancel" class="px-4 py-2 rounded-md bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium">Close</button>
                    <button id="btn-save-lis" class="flex items-center space-x-1.5 px-6 py-2 rounded-md bg-pink-600 text-white hover:bg-pink-700 font-medium">
                        <i data-lucide="save" class="w-4 h-4"></i><span>Save LIS Request</span>
                    </button>
                </footer>
            </div>

            <div id="lis-summary-view" class="modal-container absolute inset-0 hidden p-6 text-center flex flex-col justify-center items-center bg-white dark:bg-[var(--color-bg-content)]">
                <button id="close-lis-summary-x" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i data-lucide="x" class="w-6 h-6"></i></button>
                <h3 class="text-3xl font-bold text-green-700 mb-6">LAB Request Submitted Successfully!</h3>
                <div class="text-sm text-left p-4 border rounded bg-gray-50 w-full max-w-md">
                    <p class="font-bold mb-3">Acc No: LIS68012345</p>
                    <p>Hemato: CBC</p>
                    <p>Blood Chem: BUN, Creatinine</p>
                </div>
                <div class="flex justify-center space-x-4 mt-6">
                    <button class="bg-blue-600 text-white px-4 py-2 rounded font-medium"><i data-lucide="printer" class="w-4 h-4 inline mr-1"></i> Print</button>
                </div>
            </div>
        </div>
    </div>
    <div id="path-popup-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 md:p-8 z-[100] hidden">
        <div class="max-w-4xl w-full mx-auto bg-[var(--color-bg-content)] rounded-lg shadow-lg overflow-hidden border border-[var(--color-border-base)] flex flex-col" style="max-height: 90vh;">
            <header class="relative flex justify-between items-center p-6 border-b border-[var(--color-border-base)] flex-shrink-0">
              <h1 class="text-2xl font-bold text-[var(--color-text-base)]">Pathology Request (Prototype)</h1>
              <button id="close-path-popup-x" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:text-[--color-text-muted]">
                <i data-lucide="x" class="w-6 h-6"></i>
              </button>
            </header>
            <main class="w-full flex-1 overflow-y-auto p-6 md:p-8">
              <h2 class="text-xl font-semibold text-[var(--color-text-base)]">Pathology Request Module</h2>
              <p class="text-[var(--color-text-muted)] mt-2">This is a placeholder for the Path Request UI, based on the Vital Signs modal structure.</p>
            </main>
            <footer class="flex-shrink-0 flex justify-between items-center p-4 border-t border-[var(--color-border-base)] bg-[var(--color-bg-secondary)]">
              <button id="close-path-popup-cancel" class="px-4 py-2 rounded-md bg-gray-200 hover:bg-gray-300 dark:bg-[var(--color-border-base)] dark:hover:bg-gray-300 dark:text-[var(--color-text-base)] text-sm font-medium">
                  Close
              </button>
              <button id="btn-save-path" class="flex items-center space-x-1.5 px-6 py-2 rounded-md bg-fuchsia-700 text-white hover:bg-fuchsia-800 transition-colors text-sm font-medium">
                <i data-lucide="save" class="w-4 h-4"></i>
                <span>Save Path Request</span>
              </button>
            </footer>
          </div>
    </div>
    <script>
        lucide.createIcons();
    </script> 

    <script src="app-data.js"></script>
    
    <script src="app-helpers.js"></script>
    <script src="app-drawing.js"></script>
    <script src="app-charts.js"></script>
    
    <script src="app-logic.js"></script>
    
    <script src="app-init.js"></script>
    
    <script src="app.js"></script> 

    <script src="extdoc-data.js"></script>
    <script src="extdoc-logic.js"></script>
    <script src="extdoc-init.js"></script>
    <script src="extdoc-addnew-init.js"></script>
    <script src="order-pe-init.js"></script>

    <div class="fixed bottom-4 right-4 z-50 flex items-center space-x-3">

        <div id="action-menu-container" class="action-menu-container">
            
            <button id="open-df-popup-fab" class="fab-btn bg-orange-500 hover:bg-orange-600 text-white" title="ลงข้อมูล DF">
                <i data-lucide="stethoscope" class="w-5 h-5"></i>
            </button>
            
            <button id="open-tf-popup-fab" class="fab-btn bg-cyan-600 hover:bg-cyan-700 text-white" title="ลงข้อมูล TF">
                <i data-lucide="user-round-pen" class="w-5 h-5"></i> 
            </button>
            
            <button id="open-vitals-popup-fab" class="fab-btn bg-blue-600 hover:bg-blue-700 text-white" title="Vital Signs">
                <i data-lucide="activity" class="w-5 h-5"></i> 
            </button>
            
            <button id="open-eye-popup-fab" class="fab-btn bg-indigo-600 hover:bg-indigo-700 text-white" title="Eye Exam">
                <i data-lucide="eye" class="w-5 h-5"></i>
            </button>

            <button id="open-lis-popup-fab" class="fab-btn bg-pink-600 hover:bg-pink-700 text-white" title="LIS Request">
                <i data-lucide="test-tube-diagonal" class="w-5 h-5"></i>
            </button>

            <button id="open-path-popup-fab" class="fab-btn bg-fuchsia-700 hover:bg-fuchsia-800 text-white" title="Path Request">
                <i data-lucide="microscope" class="w-5 h-5"></i>
            </button>
        </div>
        <div class="flex items-center space-x-3">
            
            <button id="menu-toggle-btn" class="fab-btn bg-orange-500 hover:bg-orange-600 text-white" title="Open Actions Menu">
                <i id="menu-icon-open" data-lucide="chevron-left" class="w-6 h-6"></i>
                <i id="menu-icon-close" data-lucide="x" class="w-6 h-6 hidden" style="background-color: #FEEBC8; color: #9A3412; border-radius: 9999px; padding: 0.25rem;"></i>
            </button>

            <button id="theme-btn-light" class="fab-btn bg-white hover:bg-gray-200" title="Light Mode">
                <i data-lucide="sun" class="w-5 h-5 text-gray-700"></i>
            </button>
            
            <button id="theme-btn-dark" class="fab-btn bg-yellow-900 hover:bg-yellow-800 text-white" title="Beige Mode (Dark)">
                <i data-lucide="moon" class="w-5 h-5"></i>
            </button>

            <button id="go-to-top-btn" class="fab-btn bg-yellow-400 hover:bg-yellow-500 text-black" title="Go to Top">
                <i data-lucide="arrow-up" class="w-5 h-5"></i>
            </button>

        </div>
    </div>
    
    </body>
</html>